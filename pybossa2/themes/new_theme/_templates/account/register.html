{% extends "base.html" %}

{% block content %}
{% from "_formhelpers.html" import render_form %}
<section class="account register">
    <div class="container">
        <div class="row">
            <div class="col-md-offset-2 col-md-8">
                <h1>{{ _('계정 생성') }}</h1>

                <div id="ageCheck" class="form-inline">
                    <div class="form-group">
                        <p>{{_('16세 이상만이 계정을 생성할 수 있습니다. 생일을 입력하세요.')}}</p>
                        <input class="form-control" id="day" placeholder="DD">
                        <input class="form-control" id="month" placeholder="MM">
                        <input class="form-control" id="year" placeholder="YYYY">
                    </div>
                    <button onclick="checkAge()" style="margin-top:15px;" class="btn btn-primary">나이 검사</button>
                </div>

                {{ render_form(form, form_id="register", action_url=url_for('account.register'), btn_class="btn btn-primary btn-block" )}}

                <p class="text-center text-sm" style="margin-top:5px;">
                <span class="label label-warning"><i class="fa fa-bullhorn"></i> {{ _('공지') }}</span> 
                {{ _('당신이 ') }} 
                <strong>{{ _('계정 생성 버튼') }}
                </strong>{{ _('을 누른다면') }}
                <a target="blank" href={{terms_of_use | safe}}>{{ _('사용자 안내') }} </a>{{ _('와') }} 
                <a href={{data_use | safe}}>{{ _('데이터') }}</a>{{ _('에 대해 동의하는 것입니다')}}.
                </p>
            </div>
        </div>
    </div>
</section>
<script src="{{url_for('static', filename='js/forms.js')}}" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.1/moment.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.13.2/tingle.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.13.2/tingle.min.js"></script>
<script>
var modal = new tingle.modal({
    footer: true,
    stickyFooter: false,
    closeMethods: ['overlay', 'button', 'escape'],
    closeLabel: "Close",
    cssClass: ['custom-class-1', 'custom-class-2'],
    onOpen: function() {
        console.log('modal open');
    },
    onClose: function() {
        console.log('modal closed');
        window.location.href = '/';
    },
    beforeClose: function() {
        // here's goes some logic
        // e.g. save content before closing the modal
        return true; // close the modal
        return false; // nothing happens
    }
});

// set content
modal.setContent("<h1>16세 이상만이 계정을 생성할 수 있습니다.</h1><p>그렇지만 익명으로는 참여할 수 있습니다.</p>");

// add a button
modal.addFooterBtn('OK', 'tingle-btn tingle-btn--primary', function() {
    // here goes some logic
    modal.close();
});

// add another button
// modal.addFooterBtn('Dangerous action !', 'tingle-btn tingle-btn--danger', function() {
//     // here goes some logic
//     modal.close();
// });

function checkAge () {
    var day = document.getElementById('day').value;
    var month = document.getElementById('month').value;
    var year = document.getElementById('year').value;
    var birthday = moment(new Date(year, month, day));
    var yearsOld = moment().diff(birthday, 'year');
    console.log(yearsOld)
    if (yearsOld >= 16) {
        document.getElementById('register').style.display='block';
        document.getElementById('ageCheck').style.display='none';
        localStorage.setItem('ageCheck', true);
    } else {
        modal.open();
    }
}
</script>
<style>
#register {
    display: none;
}
</style>
{% endblock %}
