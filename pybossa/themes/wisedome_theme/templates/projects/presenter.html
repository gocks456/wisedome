{% extends "/base.html" %}
{% set active_page = "projects"  %}
{% set active_project = project.short_name %}
{% set jstop = True %}

{% block content %}
{% assets filters="jsmin", output="js/gen/full.min.js",
          "js/vendor/jquery-2.2.3.js", "js/vendor/bootstrap.js",
          "js/vendor/modernizr.min.js", "js/flashmessages.js", 
          "js/vendor/cookieconsent.min.js",
          "js/pybossa/pybossa.js",
          "js/pybossa-player/dist/pybossa-player.min.js"
          %}
          <script type="text/javascript" src="{{ ASSET_URL }}?ver=1"></script>
{% endassets %}
<script>
    Modernizr.load({
        test: window.JSON,
        nope: '{{url_for('static', filename='js/vendor/json2.min.js')}}'
});
</script>
<style>

.tab {
	overflow: hidden;
	border: 1px solid #ccc;
	background-color: #f1f1f1;
}

.tabcontent {
	display: none;
	padding: 6px 12px;
	border: 1px solid #ccc;
	border-top: none;
}

.tab button {
	background-color: inherit;
	float: left;
	border: none;
	outline: none;
	cursor: pointer;
	padding: 14px 16px;
	transition: 0.3s;
	font-size: 17px;
}


</style>

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h1><a href="{{url_for('project.details', short_name=project.short_name)}}">{{ project.name }}</a>: {{ _('Contribute') }}</h1>
        </div>
    </div>
    {% if invite_new_volunteers %}
    <div class="row">
        <div class="col-md-12">
            <p>
            {{ _("Sorry, you've contributed to all the tasks for this project, but this project still needs more volunteers, so please spread the word!") }}
            </p>
        </div>
    </div>
    {% endif %}

	<button name="answer-manager" value="answer_manager" class="btn" id="managetest">TEST</button>
	<h2 id="ajaxtest"></h2>
	<button name="modify" value="modify" class="btn" id="moditest">MODI</button>
	
	<form action="" method="GET">
		<button name="data" value="answer_manage" class="btn btn-primary">답변 관리</button>
	</form>
	{% if task_run is not none %}
	<div class="col-md-12" id="form_div" style="margin:15px 0px 15px 0px;">
		<h4 style="line-height: 1.5; word-spacing: 5px;"> <strong>답변</strong> <br/>{{ task_run.info }} </h4>
		<div style="text-align:center;">
			<form action="" method="GET" style="float: right; margin-left:10px;">
				<button name="data" value="next" type="submit" class="btn btn-primary">다음</button>
			</form>
			<form action="" method="GET" style="float: right; margin-left:10px;">
				<button name="data" value="delete" type="submit" class="btn btn-warning">답변 삭제</button>
			</form>
			<form action="" method="GET" style="float: right;">
				<button name="data" value="prev" type="submit" class="btn btn-info">이전</button>
			</form>
		</div>
	</div>
	{% endif %}
	<div style="clear:both;"></div>
	{{ project.info.task_presenter|safe }}
	<div class="tab">
		<button class="tablinks" onclick="openMenu(event, 'guide_line')">가이드라인 보기</button>
		<button class="tablinks" onclick="openMenu(event, 'example')">예시 보기</button>
		<button class="tablinks" onclick="openMenu(event, 'how_to_use')">이용방법 보기</button>
	</div>
	<div id="guide_line" class="tabcontent">
<<<<<<< HEAD
		<h3>가이드라인</h3>
<<<<<<< HEAD
		<p id ="guide_linep">{{project.long_description|markdown}}</p>
=======
=======
		<h3>가이드라인</h3><br>
>>>>>>> 19844c90879b3947f2c22c67c87f85cb3b45ee98
		<p id = "gpid">{{project.long_description|markdown}}</p>
>>>>>>> d6a7c268311142e8f5907602249c07511ddf1147
	</div>

	<div id="example" class="tabcontent">
<<<<<<< HEAD
		<h3>예시</h3>
<<<<<<< HEAD
		<p id="examplep">DB에 추가하고 넣어주기</p> 
=======
		<p id="epid">DB에 추가하고 넣어주기</p> 
>>>>>>> d6a7c268311142e8f5907602249c07511ddf1147
=======
		<h3>예시</h3><br>
		<p id="epid">{{ ex}}</p> 
>>>>>>> 19844c90879b3947f2c22c67c87f85cb3b45ee98
	</div>

	<div id="how_to_use" class="tabcontent">
		<h3>이용방법</h3><br>
		<p>{{ htd }}</p>
	</div>

    <div id='PYBOSSA_USER_LOCALE' hidden>
        {% if current_user.is_anonymous %}
        en
        {% else %}
        {{ current_user.locale }}
        {% endif %}
	</div>
</div>


	<script>
		var csrf = "{{ csrf_token() }}";
		$("#csrf_token").val(csrf);
	</script>


<script>
	$(document).ready(function(){
		$.ajaxSetup({
			beforeSend: function(xhr, settings) {
				if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
					xhr.setRequestHeader("X-CSRFToken", csrf)
				}
			}
		})

		$("#managetest").click(function(){
			var url = window.location.href;
			$.ajax({
				url:url,
				data: {"btn":$(this).val()},
				type:'POST',
				success: function(data) {
					//console.log(data);
					console.log(typeof(data));
					json = JSON.parse(data);
					console.log(typeof(json));
					console.log(Object.keys(json));
					console.log(json[0].task_run_info);
					$('#ajaxtest').text(json[0].task_run_info);
					$('#ajaxtest').attr('value',json[0].id);
				},
				error:function(request,error){
					console.log(request);
					console.log(error);
				}
			});
		});
		$("#moditest").click(function(){
			console.log('aaaa');
			var url = window.location.href;
			console.log($('#ajaxtest').attr('value'));
			$.ajax({
				url:url,
				data: {
					"btn":$(this).val(),
					"task_run_id":$('#ajaxtest').attr('value'),
					"answer": "new_answer"
				},
				type:'POST',
				success: function(data) {
					console.log(data);
				},
				error:function(request,error){
					console.log(request);
					console.log(error);
				}
			});
		});
	});
</script>



<script>
	function openMenu(evt, menuName) {
		var i, tabcontent, tablinks,temp;
		tabcontent = document.getElementsByClassName("tabcontent");
		for (i = 0; i < tabcontent.length; i++) {
			tabcontent[i].style.display = "none";
		}
		temp = evt.currentTarget.className;
		tablinks = document.getElementsByClassName("tablinks");
		for (i = 0; i < tablinks.length; i++) {
			tablinks[i].className = tablinks[i].className.replace(" active", "");
		}
		
		console.log(temp);
		if (temp !== "tablinks active"){
			evt.currentTarget.className += " active";
		    document.getElementById(menuName).style.display = "block";
		}
			  
	}

</script>

<script>
	function get_cookie(cname) {
		var name = cname + "=";
		var decodedCookie = decodeURIComponent(document.cookie);
		var ca = decodedCookie.split(';');
		for(var i = 0; i <ca.length; i++) {
			var c = ca[i];
			while (c.charAt(0) == ' ') {
				c = c.substring(1);
			}
			if (c.indexOf(name) == 0) {
				return c.substring(name.length, c.length);
			}
		}
		return "";
	}
$(document).ready(function() {
	var c = get_cookie("answer_open");
	if(c == "yes")
		$("#form_div").show();
});

/*$("#answer_manage").off('click').on('click', function(evt){
	if($("#form_div").css("display") == "none") {
		document.cookie = "answer_open=yes";
		$("#form_div").show();
	}
	else {
		document.cookie = "answer_open=no";
		$("#form_div").hide();
	}
});*/
</script>
{% endblock %}
{% block extrajs %}
{% include "_flash_messages.html" %}
{% endblock %}
