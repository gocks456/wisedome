
<link rel="stylesheet" href="/static/new_design/css/text-emotion.css">

<div class="col-12 grid-margin stretch-card">
	<div class="card bg-white">
		<div class="card-body">
			<h4 class="card-title"><i class="mdi mdi-label"></i>  &nbsp; 다음 전체 대화를 읽고 해당 문장에 대한 대화자의 감정을 선택해주세요</h4>
			<div class="row">
				<div class="col-xl-9 ">
					<pre class="textsize" id="question"></pre>
				</div>

				<div class="col-xl-3 answers">
					<div class="emotion8">  
						<button type="radio" class="btn btn-inverse-primary btn-submit"><i class="mdi mdi-emoticon"></i> 기쁨</button>
						<button type="radio" class="btn btn-inverse-primary btn-submit"><i class="mdi mdi-emoticon-happy"></i> 놀람</button>
						<button type="radio" class="btn btn-inverse-primary btn-submit"><i class="mdi mdi-emoticon-devil"></i> 분노</button>
						<button type="radio" class="btn btn-inverse-primary btn-submit"><i class="mdi mdi-emoticon-sad"></i> 슬픔</button>
						<button type="radio" class="btn btn-inverse-primary btn-submit"><i class="mdi mdi-emoticon-poop"></i> 혐오</button>
						<button type="radio" class="btn btn-inverse-primary btn-submit"><i class="mdi mdi-emoticon-cool"></i> 공포</button>
						<button type="radio" class="btn btn-inverse-primary btn-submit"><i class="mdi mdi-emoticon-tongue"></i> 경멸</button>
						<button type="radio" class="btn btn-inverse-primary btn-submit"><i class="mdi mdi-emoticon-neutral"></i> 중립</button>  
					</div>
					<!--
					<div class=" popup card-inverse-secondary">
						<ul class="list-arrow">
							<h6>버튼 컬러별 답변 참고</h6>
							<li class="list-group-item"> <span class="badge computer-select">분홍색</span>   :  컴퓨터 제시 답안   </li>
							<li class="list-group-item"> <span class="badge human-select">주황색</span>  :  사람 제시 답안 </li>
							<li class="list-group-item"> <span class="badge human-select">주황색</span>  :  컴퓨터 + 사람   공통으로 제시된 답안 </li>
							<i class="mdi mdi-close text-success" id="bannerClose"></i> 
						</ul> 
					</div>
					<i class="mdi mdi-comment-alert-outline text-success" id="bannerOpen">컬러별 버튼 의미</i>
					-->
				</div>
			</div>
		</div>
	</div>
</div>

<!--답변관리 섹션(파란버튼)-->
<div class="col-md-12 grid-margin" id="manage-answer-top">
	<div class="card bg-white">
		<div class="card-body ">
			<h4 class="card-title "><i class="mdi mdi-format-list-numbered"></i>  &nbsp; 답변관리</h4>
			<div class="row">
				<div class="col-xl-9 d-inline-flex">
					<p class="card-description mt-3"> 내가 풀었던 문제를 다시보고 답변을 수정할 수 있습니다. 답변을 수정하고 싶으면 버튼을 클릭해주세요 </p>
				</div>
				<div class="col-xl-3 answers">    <!---답변관리 선택 버튼-->
					<button type="button" class="btn btn-inverse-info" id="manage-answer-btn"><i class="mdi mdi-file-multiple"></i>답변관리 </button>
				</div>
			</div>
		</div>
	</div>
</div>


<!---클릭후 뜨는 나의 답변관리 영역-->
<div class="col-md-12 grid-margin" id="manage-answer">
	<div class="card bg-white">
		<div class="card-body">
			<h4 class="card-title"><i class="mdi mdi-message-text"></i> &nbsp; 나의답변</h4>

			<div class="page-btn-group">

			</div>

			<div class="row mt-4">
				<div class="col-xl-9 main-text"> <!---이전 문제화면 뜨는곳-->

					<div class="previous-question pageContents" id="page1"><!---1번문제화면-->
						<p class="textsize" id="prev_problem"></p> 
						<p class="card-description">나의답변 <span id="prev_answer"></span>
					</div>


					<!--답변 변경 버튼-->
					<div class="reselect">   
						<p class="card-description font-weight-bold"> 답변변경</p>
						<button type="radio" class="btn btn-outline-primary btn-modi"  onclick="enableButton()"> 기쁨</button>
						<button type="radio" class="btn btn-outline-primary btn-modi"  onclick="enableButton()"> 놀람</button>
						<button type="radio" class="btn btn-outline-primary btn-modi"  onclick="enableButton()"> 분노</button>
						<button type="radio" class="btn btn-outline-primary btn-modi"  onclick="enableButton()"> 슬픔</button>
						<button type="radio" class="btn btn-outline-primary btn-modi"  onclick="enableButton()"> 혐오</button>
						<button type="radio" class="btn btn-outline-primary btn-modi"  onclick="enableButton()"> 공포</button>
						<button type="radio" class="btn btn-outline-primary btn-modi"  onclick="enableButton()"> 경멸</button>
						<button type="radio" class="btn btn-outline-primary btn-modi"  onclick="enableButton()"> 중립</button>
					</div>
				</div>

				<div class="col-xl-3 answers"> <!--답변수정 및 제출 영역-->
					<button type="edit" class="btn btn-danger" id="edit"><i class="mdi mdi-tooltip-edit"></i>수정하기</button>
					<button type="submit" class="btn btn-success " id="submit" disabled ><i class="mdi mdi-cloud-upload"></i>제출하기</button>
				</div>
			</div>
		</div>
	</div>
</div>

<script src="/static/new_design/js/text-emotion.js"></script>

	<script>
		// 버튼 제작 메소드 ( i = icon / text = 텍스트 및 value 값 / btn = class이름
		function makeButton(i, text, value, id, btn) {
			//var div = document.createElement("div");
			var button = document.createElement("button");

			console.log(btn);

			button.id = id;
			button.value = value;
			button.className = btn;
			button.innerHTML = i;

			button.appendChild(document.createTextNode(text));
			return button;
		};

pybossa.taskLoaded(function(task, deferred){
	if ( !$.isEmptyObject(task) ) {
		deferred.resolve(task);
	} // End if task empty
	else {
		deferred.resolve(task);
	}
});

pybossa.presentTask(function(task, deferred){
	if ( !$.isEmptyObject(task) ) {
		if(task.info.dialog == 'Done') {
			pybossa.saveTask( task.id, -1, {}).done( function(data) { deferred.resolve(); });
			delete task;
		} 
		setUserGraph();
		//var emotion_template = $(".emotion8").html();
		var dialog = task.info.dialog;
		dialog = dialog.replace("<font color = ‘red’ size = ‘5px’>", '<span class="highlight">');
		dialog = dialog.replace("</font>", "</span>");
		$("#question").html(dialog);
		//$(".btn-submit:contains(" + task.info.answer_com + ")").attr("class", "btn computer-select btn-submit");
		//$(".btn-submit:contains(" + task.info.answer_per + ")").attr("class", "btn human-select btn-submit");

		$(".btn-submit").on('click', function(evt){
			var answer = $(this).text();
			if ($(this).text() == "")
				return;
			//$(".emotion8").html(emotion_template);
			$("#manage-answer-top").show();
			$("#manage-answer").hide();
			pybossa.saveTask( task.id, answer).done( function(data) {
				deferred.resolve();
			});
		});

	}
	else {
	}
});

pybossa.run('dialog_test');
</script>



<script>
	$(document).ready(function(){

		var answer_list; // 답변을 Page(10개)를 기준으로 나누어 놓은 list
		var current_index;

		function answer_btn_set(index) {
			var button_which = $('.page-btn-group');
			button_which.empty();
			console.log(answer_list);
			if (index < 0)
				return;
			var data = answer_list[index];
			var last_value = 0;

			var button = makeButton("<i class='mdi mdi-chevron-left'></i>", "", "", "answer_left_btn", "btn btn-inverse-secondary btn-sm");
			$(button).attr('style', 'margin-right:4px; margin-buttom:10px;');
			button_which.append(button);

			for (var i=0; i<10; i++) {
				var button = document.createElement("button");
				button.className = "btn btn-inverse-secondary btn-sm tablink";
				$(button).attr('style', 'margin-right:4px;');
				if (data[i] != undefined) {
					button.value = data[i].id;
					button.appendChild(document.createTextNode(data[i].rank));
					last_value = data[i].rank;
					button.id = 'find_answer_data';
					if (i+1 == data.length || data[i+1] == undefined) {
						button.className = "btn btn-primary btn-sm tablink";
						button.id = 'active_btn';	
						start = data[i].task_info.dialog.indexOf("size = ");
						end = data[i].task_info.dialog.indexOf("</font>");
						$('#prev_problem').text(data[i].task_info.dialog.substring(start + 13, end));
						$('#prev_answer').text(data[i].task_run_info);
						$('#prev_answer').attr('value', data[i].id);
					}
				}
				else {
					button.appendChild(document.createTextNode(last_value + 1));
					button.disabled = true;
					last_value++;
				}
				button_which.append(button);
			}
			var button = makeButton("<i class='mdi mdi-chevron-right'></i>", "", "", "answer_right_btn", "btn btn-inverse-secondary btn-sm");
			$(button).attr('style', 'margin-right:4px; margin-buttom:10px;');
			button_which.append(button);
		}

		$("#manage-answer-btn").click(function(){
			var url = window.location.href;
			$.ajax({
				url:url,
				data: {"btn": "answer_manager"},
				type:'POST',
				success: function(data) {
					json = JSON.parse(String(data));
					answer_list = json;
					console.log(data);
					console.log(typeof(data));
					answer_btn_set(answer_list.length - 1);
					current_index = answer_list.length - 1;
					console.log(current_index);
					start = answer_list[0][0].task_info.dialog.indexOf("size = ");
					end = answer_list[0][0].task_info.dialog.indexOf("</font>");
					console.log(answer_list[0][0].task_info.dialog.substring(start + 13, 51));

				},
				error:function(request,error){
					console.log(request);
					console.log(error);
				}
			});
		});

		$(document).on("click", "#answer_left_btn", function() {
			if ( current_index == 0 )
				return;
			else {
				answer_btn_set(current_index - 1);
				current_index--;
			}
		});
		$(document).on("click", "#answer_right_btn", function() {	
			if ( current_index == answer_list.length - 1 )
				return;
			answer_btn_set(current_index + 1);
			current_index++;
		});

		$(document).on("click", "#find_answer_data", function() {
			var url = window.location.href;
			var button = $(this);
			$.ajax({
				url:url,
				data: {"btn": "get_answer_data",
					"id": $(this).val()},
				type: 'POST',
				success: function(res) {
					data = JSON.parse(res);
					console.log(data);

					$("#active_btn").attr('class', "btn btn-inverse-secondary btn-sm tablink");
					$("#active_btn").attr('id', 'find_answer_data');
					$(button).attr('class', "btn btn-primary btn-sm tablink");
					$(button).attr('id', 'active_btn');
					start = data.task_info.dialog.indexOf("size = ");
					end = data.task_info.dialog.indexOf("</font>");
					$('#prev_problem').text(data.task_info.dialog.substring(start + 13, end));
					$('#prev_answer').text(data.task_run_info);
					$('#prev_answer').attr('value', data.id);
				},
				error:function(request, error) {
					console.log(request);
					console.log(error);
				}
			});
		});
	});

$(document).on("click", ".btn-modi", function() {
	$(".modi-active").attr('class', "btn btn-outline-primary btn-modi");
	$(this).attr('class', "btn btn-outline-primary btn-modi modi-active active");
});

$(document).on("click", "#submit", function() {
	var url = window.location.href;
	var answer = $(".modi-active").text();
	if (answer == "")
		return;
	$.ajax({
		url:url,
		data: {
			"btn": "modify",
			"task_run_id":$('#prev_answer').attr('value'),
			"answer": answer,
		},
		type:'POST',
		success: function(data) {
			$("#prev_answer").text(answer);
			$(".modi-active").attr('class', "btn btn-outline-primary btn-modi");
			$(".reselect").css("display", "none");

		},
		error:function(request,error){
			console.log(request);
			console.log(error);
		}
	});
});
</script>



