<! -- Fix for Bootstrap css with Google Maps https://github.com/twitter/bootstrap/issues/1552 -->
<style type="text/css">
h3 {
	line-height:1.5;
	word-spacing:5px;
}
table#necat {
    font-family: arial, sans-serif;
    border-collapse: collapse;
    width: 100%;
}

table>td, th {
    border: 1px solid black;
    text-align: center;
    margin: auto;
    padding: 8px;
}

tr:nth-child(even) {
    background-color: #dddded;
}
.btn {
	margin: 20px 10px 20px 0px;
}
</style>
<div class="row">
    <!-- Success and Error Messages for the user -->
    <div class="col-md-12" style="height:50px">
        <!-- Success alert box -->
        <div id="success" class="alert alert-success" style="display:none;">
            <a class="close">×</a><strong>Well done!</strong> Your answer has been saved
        </div>
        <!-- Task completed alert box -->
        <div id="taskcompleted" class="alert alert-info" style="display:none;">
            <strong>The task has been completed!</strong> Thanks a lot!
        </div>
        <!-- Task loading alert box -->
        <div id="loadingTask" class="alert alert-info">
            <strong>Loading task...</strong>
        </div>
        <!-- Task completed alert box -->
        <div id="finish" class="alert alert-success" style="display:none;">
            <strong>Congratulations!</strong> You have participated in all available tasks!
            <br/>
            <div class="alert-actions">
<!--                <a class="btn small" href="/" style="color:white">Go back</a>-->
                <a class="btn-small" href="/project/category/featured" style="color:white;">Check other projects</a>
            </div>
        </div>
        <!-- Error alert box -->
        <div id="error" class="alert alert-danger" style="display:none;">
            <a class="close">×</a>
            <strong>Error!</strong> Something went wrong, please contact the site administrators
        </div>
        <!-- Old Browser alert box -->
        <div id="oldBrowser" class="alert alert-info" style="display:none;">
            <a class="close">×</a>
            <p><strong>Sorry!</strong> Your web browser does not support the application.<p>
            <div class="alert-actions">
				<a class="btn small" href="/project/category/featured">Please, try with another project</a>
			</div>
		</div>
	</div><!-- End of span8 col-md-offset-2-->
</div><!-- End of Row-->

<div class="row skeleton">
	<div class="skeleton col-md-9">
		<u>문장 분석 결과를 선택하시오.</u><br/><br/>
		<div id="sentence">Question</div>
		<div id="candidate"></div>
		<!--<button id="explain" class="btn btn-explain" style="float: right; display: none;">해설</button><br/><br/>-->

		<p>Task: <span id="task-id" class="label label-warning">#</span></p><br/>
		<p>완료한 작업 수: <span id="done" class="label label-info"></span> / 총 작업 수:
		<span id="total" class="label label-inverse" style="background-color: #3498DB;"></span></p>
		<div class="progress progress-striped">
			<div id="progress" rel="tooltip" title="#" class="progress-bar" style="width: 0%;"  role="progressbar"></div>
		</div>

	</div>
	<div class="skeleton col-md-12">
		<button id="help" class="btn btn-info">HELP</button>
		<div id="div3" style="display:none;">
			<div class="explain">
				<font size="2">
					<table class="table table-bordered" id="necat">
						<tbody>
							<tr>
								<th scope="col" style="width:4.6%; background-color:#dddded;">태그</th>
								<th scope="col">설명</th>
								<th scope="col">예시</th>
							</tr>
							<tr>
								<td rowspan="2" style="background-color:white;">객관적</td>
								<td>&middot; 실제 일어난 사건에 대한 사실 전달 / 상황에 대한 설명</td>
								<td>&middot; "극 후반, 군입대를 선언한 길창주를 찾아간 백승수가 그의 자녀를 보고 오열하며 궁금증을 자아낸 상황"</td>
							</tr>
							<tr>
								<td>&middot; 정도의 표현이 있으나 주된 내용이 사실 전달인 경우</td>
								<td>&middot; 인천시는 이러한 총체적 경제위축과 소상공인의 고사위기를 극복하기 위해 인천e음 캐시백을 10%까지 확대하는 파격적인 대책을 마련했다.</td>
							</tr>
							<tr>
								<td rowspan="4" style="background-color:#dddded;">주관적</td>
								<td>&middot; 작성자의 주장, 추측, 의혹을 포함하는 경우</td>
								<td>&middot; '2020년형 캐리어 클라윈드 공기청정기'는 에너지 신효율 1등급 제품으로 소비자들의 전기료 걱정도 덜었다.</td>
							</tr>
							<tr>
								<td>&middot; 작성자의 의견이 직접 표현되는 경우</td>
								<td>&middot; 롱런하던 배틀그라운드의 인기가 시들해진 탓이다.</td>
							</tr>
							<tr>
								<td>&middot; 인용에서 인용 대상의 의견이 나타나는 경우</td>
								<td>&middot; <strong>삼성전자 관계자는</strong> "고가의 스마트폰에 선뜻 지갑을 열지 않는 여성 소비자로 타깃층을 확대한 제품이 갤럭시Z플립"이라고 <strong>강조했다.</strong></td>
							</tr>
							<tr>
								<td>&middot; 사실 확인이 되지않은 내용 (추측)</td>
								<td>&middot; 여야는 공수처 법안을 놓고 필리버스터 대치를 벌인 뒤 오는 30일께 표결할 것으로 <strong>예상된다.<strong></td>
							</tr>
						</tbody>
					</table>
				</font>

			</div>
		</div>
	</div>
</div>

<!-- PyBossa interface -->
<script>
/*function showExplain(task) {
	$('.explain').text(task.info.explain);
}*/

$("#help").off('click').on('click', function(evt){
	$("#div3").toggle();
});

function loadUserProgress() {
	pybossa.userProgress('emotion_test2').done(function(data){
		var pct = Math.round((data.done*100)/data.total);
		console.log(pct);
		$("#progress").css("width", pct.toString() +"%");
		$("#progress").attr("title", pct.toString() + "% completed!");
		$("#progress").tooltip({'placement': 'left'}); 
		$("#total").text(data.total);
		$("#done").text(data.done);
	});
}

function makeButton(name, value, text, btn) {
    //var div = document.createElement("div");
	var button = document.createElement("button");

	button.id = name;
	button.value = value;
	button.className = "btn btn-submit " + btn;
	button.appendChild(document.createTextNode(text));
	//div.appendChild(button);
	
    //return div;
	return button;
};

pybossa.taskLoaded(function(task, deferred){
    if ( !$.isEmptyObject(task) ) {
        $("#loadingTask").hide();
        deferred.resolve(task);
        } // End if task empty
    else {
        deferred.resolve(task);
        }
});

pybossa.presentTask(function(task, deferred){
    if ( !$.isEmptyObject(task) ) {
        if (task.state == 'completed') {
            $('#taskcompleted').show();
        }

       if(task.info.sentence == 'Done') {
			pybossa.saveTask( task.id, -1, {}).done( function(data) { deferred.resolve(); });
			delete task;
		} else {
				loadUserProgress();
				document.getElementById("sentence").innerHTML = "<h3>" + task.info.sentence + "</h3>";

				var buttonlist = document.getElementById("candidate");
				var btn1 = makeButton("candidate", "객관", " 객관적", "btn-success");
				var btn2 = makeButton("candidate", "주관", " 주관적", "btn-warning");
				buttonlist.innerHTML = ''; // button input init
				buttonlist.appendChild(btn1);
				buttonlist.appendChild(btn2);
				$("#task-id").text(task.id);
				$("#loadingTask").hide();
		}
		/*$(".btn-explain").off('click').on('click', function(evt){
			showExplain(task);
		});*/

        $(".btn-submit").off('click').on('click', function(evt){
			/*var chkval = document.getElementsByName('candidate');
			var answer;
			var answer_value;
			for(var i=0; i<chkval.length; i++){
				if(chkval[i].checked) {
					answer = task.info.sentence + ", " + chkval[i].value;
					answer_value = chkval[i].value;
				}
			}*/
			var answer = (this).value;
			answer = task.info.sentence +"+"+ answer;
            console.log(answer);
            console.log(task.id);

			/*if(task.info.answer != ""){
				if (task.info.answer != answer_value){
					alert("오답 입니다.");
					$('#explain').show();
					return false;
				}
			}*/
			$('#explain').hide();

		    // TODO: gt와 현재 answer가 같은지를 확인

		    // db에 현재 결과 저장
            pybossa.saveTask( task.id, answer).done( function(data) {
                // Show the feedback div
                $("#success").fadeIn();
                // Fade out the pop-up after a 2000 miliseconds
                setTimeout(function() { $("#success").fadeOut() }, 2000);
                deferred.resolve();
            });
        });
    }
    else {
        $(".skeleton").hide();
        $("#loadingTask").hide();
        $("#finish").fadeIn();	
    }
});

pybossa.run('emotion_test2');
</script>
