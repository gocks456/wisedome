<div class="row">
    <!-- Success and Error Messages for the user --> 
    <div class="col-md-6 col-md-offset-2" style="height:50px">
        <div id="success" class="alert alert-success" style="display:none;">
            <a class="close">×</a>
			<strong>답변 저장 중...</strong> 
        </div>
        <div id="loading" class="alert alert-info" style="display:none;">
            <a class="close">×</a>
            Task 불러오는 중...
        </div>
        <div id="finish" class="alert alert-success" style="display:none;">
            <strong>프로젝트 완료!</strong> 모든 일감을 수행하였습니다.
            <br/>
            <div class="alert-actions">
                <a class="btn small" href="/project/category/featured">다른 프로젝트 둘러보기</a>
            </div>
        </div>
        <div id="error" class="alert alert-danger" style="display:none;">
            <a class="close">×</a>
            <strong>오류 발생!</strong> 문제가 발생하였습니다. 관리자에게 문의 하세요.
        </div>
    </div> <!-- End Success and Error Messages for the user -->
</div> <!-- End of Row -->

<!--
    Task DOM for loading the Sound Cloud iframe 
    It uses the class="skeleton" to identify the elements that belong to the
    task.
-->
<div class="row skeleton"> <!-- Start Skeleton Row-->
	<div class="col-md-10 "><!-- Start of Question and Submission DIV (column) -->
		<h1 id="question">녹음된 음성을 듣고 받아 써 주세요.</h1> <!-- The question will be loaded here -->

		<div class="col-md-12"><!-- Start of Sound Cloud DIV (column) -->
			<div id="sound-clip"style = "margin-top:20px;margin-bottom:20px">
			</div>
		</div><!-- End of Sound Cloud DIV (columnt) -->

		<div id="answer"> <!-- Start DIV for the submission buttons -->
			<textarea id="text-box" name="text-box" placeholder="문장을 듣고 따라 써주세요." row="2" style="width:100%;"></textarea>
			<!-- 인풋 박스 -->
			<button class="btn btn-answer btn-success">저장</button>
		</div><!-- End of DIV for the submission buttons -->
	</div>
</div><!-- End of Skeleton Row -->

<script type="text/javascript" src="/static/js/pybossa-player/dist/pybossa-player.min.js"></script>
<script type="text/javascript">
(function() {
function loadUserProgress() {
    pybossa.userProgress('ST3').done(function(data){
        var pct = Math.round((data.done*100)/data.total);
        $("#progress").css("width", pct.toString() +"%");
        $("#progress").attr("title", pct.toString() + "% completed!");
        $("#progress").tooltip({'placement': 'left'}); 
        $("#total").text(data.total);
        $("#done").text(data.done);
    });
}

pybossa.taskLoaded(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        // keep this  if block for backwards compatibility...
        if (task.info.song) {
            task.info.audio_url = task.info.song;
        }
        deferred.resolve(task);
    }
    else {
        deferred.resolve(task);
    }
});

pybossa.presentTask(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        loadUserProgress();
        var player = PybossaPlayer(task.info.audio_url, 'sound-clip', true);

        $('.btn-answer').off('click').on('click', function(evt) {
            var answer = $("#text-box").val();
			$("#text-box").val('');
            if (answer != '') {
                pybossa.saveTask(task.id, answer).done(function() {
                    player.destroy();
                    deferred.resolve();
                });
                $("#loading").fadeIn(500);
            }
            else {
                $("#error").show();
            }
        });
        $("#loading").hide();
    }
    else {
        $(".skeleton").hide();
        $("#loading").hide();
        $("#finish").fadeIn(500);
    }
});

pybossa.run('ST3');
})();
</script>
