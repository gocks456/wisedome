<div class="row">
	<!-- Success and Error Messages for the user --> 
	<div class="col-md-6 col-md-offset-2" style="height:50px">
		<div id="success" class="alert alert-success" style="display:none;">
			<a class="close">×</a>
			<strong id="i18n_welldone">잘하셨습니다!</strong> <span id="i18n_welldone_text">정답이 저장되었습니다</span>
		</div>
		<div id="loading" class="alert alert-info" style="display:none;">
			<a class="close">×</a>
			<span id="i18n_loading_next_task">로딩중...</span>
		</div>
		<div id="taskcompleted" class="alert alert-info" style="display:none;">
			<strong id="i18n_task_completed">완료 되었습니다!</strong> <span id="i18n_thanks">감사합니다!</span>
		</div>
		<div id="finish" class="alert alert-success" style="display:none;">
			<strong id="i18n_congratulations">축하드립니다!</strong> <span id="i18n_congratulations_text">모든 작업을 완료했습니다!</span>
			<br/>
			<div class="alert-actions">
				<a class="btn small" href="/" style="color:white;">돌아가기</a>
				<a class="btn small" href="/app" style="color:white;">다른 프로젝트 찾아보기</a>
			</div>
		</div>
		<div id="error" class="alert alert-danger" style="display:none;">
			<a class="close">×</a>
			<strong>에러!</strong> 문제가 발생했으므로 관리자에게 문의하십시오.
		</div>
	</div> <!-- End Success and Error Messages for the user -->
</div> <!-- End of Row -->

<style>
[type="radio"]:checked,
[type="radio"]:not(:checked) {
	position: absolute;
	left: -9999px;
}
[type="radio"]:checked + label,
[type="radio"]:not(:checked) + label
{
	position: relative;
	padding-left: 30px;
	margin-top: 20px;
	margin-left: 30px;
	cursor: pointer;
	line-height: 20px;
	display: inline-block;
	color: #666;
}
[type="radio"]:checked + label:before,
[type="radio"]:not(:checked) + label:before {
	content: '';
	position: absolute;
	left: 0;
	top: 0;
	width: 18px;
	height: 18px;
	border: 1px solid #ddd;
	border-radius: 100%;
	background: #fff;
}
[type="radio"]:checked + label:after,
[type="radio"]:not(:checked) + label:after {
	content: '';
	width: 12px;
	height: 12px;
	background: #00599a;
	position: absolute;
	top: 3px;
	left: 3px;
	border-radius: 100%;
	-webkit-transition: all 0.2s ease;
	transition: all 0.2s ease;
}
[type="radio"]:not(:checked) + label:after {
	opacity: 0;
	-webkit-transform: scale(0);
	transform: scale(0);
}
[type="radio"]:checked + label:after {
	opacity: 1;
	-webkit-transform: scale(1);
	transform: scale(1);
}
</style>

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;border-color:#9ABAD9;float=right;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#9ABAD9;color:#444;background-color:#EBF5FF;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#9ABAD9;color:#fff;background-color:#409cff;}
.tg .tg-dbbi{font-weight:bold;font-size:15px;border-color:inherit;text-align:center;vertical-align:top}
.tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top}
</style>


<div class="row skeleton"> <!-- Start Skeleton Row-->
	<div class="col-md-12 "><!-- Start of Question and Submission DIV (column) -->
		<!-- <h1 id="question"><span id="i18n_question">패러프레이징</span></h1> -->  <!-- The question will be loaded here -->
		<div id="paraphrasing" style="background-color:white;"></div><!-- Start of Photo DIV (column) -->
		<!-- Feedback items for the user -->
		<!-- <p style="margin-top:30px;"><span id="i18n_working_task">현재 작업 번호:</span> <span id="task-id" class="label label-warning">#</span></p> -->
		<!--		<p><span id="i18n_tasks_completed">완료한 작업 수:</span> <span id="done" class="label label-info"></span> <span id="i18n_tasks_from"> / 총 작업 수:</span> -->
		<!-- Progress bar for the user -->
		<!-- <span id="total" class="label label-info"></span></p>
		<div class="progress progress-striped">
			<div id="progress" rel="tooltip" title="#" class="progress-bar" style="width: 10%;"  role="progressbar"></div>
		</div>

		-->

		<div id="answer" style="margin-top:30px; font-size:15px;"> <!-- Start DIV for the submission buttons -->

			<div id="help" style="float:right;">
				<p> <button id="btn-help" style="float:right;">?</button> </p>

				<p> <table class="tg" id="help_table" style="float:right; margin-top:20px;">
					<tr>
						<th class="tg-dbbi">점수</th>
						<th class="tg-dbbi">기준</th>
					</tr>
					<tr>
						<td class="tg-0pky">문장이 같음</td>
						<td class="tg-0pky">문장이 똑같은 경우</td>
					<tr>
						<td class="tg-0pky">낮음</td>
						<td class="tg-0pky">문장 구조가 이상한 경우, 말이 안되는 경우, 두 문장의 의미가 다른 경우</td>
					</tr>
					<tr>
						<td class="tg-0pky">보통</td>
						<td class="tg-0pky">단어만 바뀌고 문장 구조가 동일한 경우</td>
					</tr>
					<tr>
						<td class="tg-0pky">높음</td>
						<td class="tg-0pky">문장 구조가  바뀐 경우</td>
					</tr>
				</table> </p>
			</div>
			
			<div id="answer-box1" style="display:none;">
				<p> <input type="radio" id="answer_box1-1" name="answer1" value =-1> <label for="answer_box1-1">문장이 같음</label>
			    <input type="radio" id="answer_box2-1" name="answer1" value =0> <label for="answer_box2-1">낮음</label>
			    <input type="radio" id="answer_box3-1" name="answer1" value =1> <label for="answer_box3-1">보통</label>
				<input type="radio" id="answer_box4-1" name="answer1" value =2> <label for="answer_box4-1">높음</label> </p>
			</div>
			   
			<div id="answer-box2" style="display:none;">
				<p> <input type="radio" id="answer_box1-2" name="answer2" value =-1> <label for="answer_box1-2">문장이 같음</label>
			    <input type="radio" id="answer_box2-2" name="answer2" value =0> <label for="answer_box2-2">낮음</label>
			    <input type="radio" id="answer_box3-2" name="answer2" value =1> <label for="answer_box3-2">보통</label>
				<input type="radio" id="answer_box4-2" name="answer2" value =2> <label for="answer_box4-2">높음</label> </p>
			</div>

			<div id="answer-box3" style="display:none;">
				<p> <input type="radio" id="answer_box1-3" name="answer3" value =-1> <label for="answer_box1-3">문장이 같음</label>
			    <input type="radio" id="answer_box2-3" name="answer3" value =0> <label for="answer_box2-3">낮음</label>
			    <input type="radio" id="answer_box3-3" name="answer3" value =1> <label for="answer_box3-3">보통</label>
				<input type="radio" id="answer_box4-3" name="answer3" value =2> <label for="answer_box4-3">높음</label> </p>
			</div>

			<div style="margin:auto;">
			<p><button class="btn btn-answer" id="button" value="next" style="background-color:#00599a; margin-top:20px; color:white; width:300px;">다음</button></p>
			</div>

		</div><!-- End of DIV for the submission buttons -->

		<p style="margin-top:150px;"><span id="i18n_tasks_completed">완료한 작업 수:</span> <span id="done" class="label label-info"></span> <span id="i18n_tasks_from"> / 총 작업 수:</span>
		<!-- Progress bar for the user -->
		<span id="total" class="label label-info"></span></p>
		<div class="progress progress-striped">
			<div id="progress" rel="tooltip" title="#" class="progress-bar" style="width: 10%;"  role="progressbar"></div>
		</div>


		<!-- 
	  This application uses Disqus to allow users to provide some feedback.
	  The next section includes a button that when a user clicks on it will
	  load the comments, if any, for the given task
		-->
<!--		<div id="disqus_show_btn" style="margin-top:5px;">
			<button class="btn btn-primary btn-large btn-disqus" onclick="loadDisqus()"><i class="fa fa-comments"></i> <span id="i18n_show_comments">Show comments</span></button>
			<button class="btn btn-large btn-disqus" onclick="loadDisqus()" style="display:none"><i class="fa fa-comments"></i> <span id="i18n_hide_comments">Hide comments</span></button>
</div>--><!-- End of Disqus Button section -->
		<!-- Disqus thread for the given task -->
		<!--<div id="disqus_thread" style="margin-top:5px;display:none"></div>-->     <!-- Disque (Show commants) 필요가 없어서 주석처리해둠-->
	</div><!-- End of Question and Submission DIV (column) -->
</div><!-- End of Photo DIV (columnt) -->
</div><!-- End of Skeleton Row -->


<script type="text/javascript">

	// 라디오 버튼이 활성화 되면 다음버튼이 나타나게 바꾸기 그리고 너무 밋밋함... 하이라이트를 주든 뭔가 대책이 필요 할때 지루할듯
	//$("#button").show();
	$("#help_table").hide();

	$(document).ready(function() {
		/*$("input:radio[name=answer1]").click(function() {
			$("input:radio[name=answer2]").click(function() {
				$("input:radio[name=answer3]").click(function() {
			$("#button").show();
				})
			})
		})*/

		$("#btn-help").click(function() {
			if($("#help_table").css("display") == "none"){
				$("#help_table").show();
			}else{
				$("#help_table").hide();
			}
		})
		});

//$(window).on('popstate', function(event) {
//	window.location = document.location.href;
//});

</script>

<script>

	function split_str(str1, str2) {
		var str1_split = str1.split(" ");
		var str2_split = str2.split(" ");

		var diff_text = new Array();
		for(var i=0; i<str1_split.length; i++){
			var r=0;
			if (str1_split[i] != str2_split[i]) {
				diff_text[r] = str2_split[i];
				r++;
			}
		}
		return diff_text;
	}

function loadUserProgress() {
	pybossa.userProgress('check.10').done(function(data){
		var pct = Math.round((data.done*100)/data.total);
		$("#progress").css("width", pct.toString() +"%");
		$("#progress").attr("title", pct.toString() + "% completed!");
		$("#progress").tooltip({'placement': 'left'}); 
		$("#total").text(data.total);
		$("#done").text(data.done);
	});
}

var answerArr = [0,0,0];

pybossa.taskLoaded(function(task, deferred){
	if ( !$.isEmptyObject(task) ) {
		var div = $('<div/>');
		div.attr('id', 'paraphrase' + task.id);
		var p1 = $('<p/>');
		var p2 = $('<p/>');
		var p3 = $('<p/>');
		var p4 = $('<p/>');

		var from1 = $("<strong/>")
		var from2 = $("<strong/>")
		var from3 = $("<strong/>")
		var from4 = $("<strong/>")

		from1.text("입력문장"+task.info.Number+" : ")
		from2.text("출력문장1 : ")
		from3.text("출력문장2 : ")
		from4.text("출력문장3 : ")

		
		p1.addClass('first');
		if (task.info.hasOwnProperty('입력문장')) {
			p1.text(task.info.입력문장);
		}

		p1.prepend(from1)
		
		p2.addClass('second');
		if (task.info.hasOwnProperty('BEST1')) {
			if (task.info.입력문장 != task.info.BEST1) {
				p2.text(task.info.BEST1);

				var box1 = $("#answer-box1").html();
				$(p2).append(box1);
				p2.prepend(from2)
			}
			else {
				answerArr[0] = -1;
			}
		}

		p3.addClass('third');
		if (task.info.hasOwnProperty('BEST2')) {
			if (task.info.입력문장 != task.info.BEST2) {
				//p3.text(task.info.BEST2);

				text = split_str(task.info.입력문장, task.info.BEST2);
				console.log(text);

				for(var i=0; i<text.length; i++) {
					test = task.info.BEST2.replace(text[i], "aa" + text[i] + "bb" );
					console.log(test);
					p3.text(test);
				}

				var box2 = $("#answer-box2").html();
				p3.prepend(from3)
				$(p3).append(box2);
			}
			else {
				//console.log(task.info.Number, task.info.입력문장, task.info.BEST2);
				answerArr[1]=-1;
			}
		}


		p4.addClass('fourth');
		if (task.info.hasOwnProperty('BEST3')) {
			if (task.info.입력문장 != task.info.BEST3) {
				p4.text(task.info.BEST3);
				var box3 = $("#answer-box3").html();
				$(p4).append(box3);
				p4.prepend(from4)
			}//
			else {
				//console.log(task.info.Number, task.info.입력문장, task.info.BEST3);
				answerArr[2]=-1;
			}
		}

		div.append(p1);
		div.append(p2);
		div.append(p3);
		div.append(p4);
		p1.css({"font-size": "20px"});
		p2.css({"font-size": "20px", "margin-top" : "15px"});
		p3.css({"font-size": "20px", "margin-top" : "15px"});
		p4.css({"font-size": "20px", "margin-top" : "15px"});

		task.info.paraphrase = div;
		deferred.resolve(task);
	}
	else {
		deferred.resolve(task);
	}	
});

pybossa.presentTask(function(task, deferred){
	if ( !$.isEmptyObject(task) ) {
		loadUserProgress();

		$('#paraphrasing').html('').append(task.info.paraphrase);
		//$("#msgid_" + task.id).focus();
		//$("#question").html(task.info.question);
		$('#task-id').html(task.id);
		$('.btn-answer').off('click').on('click', function(evt) {
			var task_num = parseInt(task.info.Number);
			var answer1 = parseInt($('[name="answer1"]:checked').attr("value"));
			var answer2 = parseInt($('[name="answer2"]:checked').attr("value"));
			var answer3 = parseInt($('[name="answer3"]:checked').attr("value"));

			if (isNaN(answer1) && answerArr[0]!=0) {
				answer1 = answerArr[0];
			}

			if (isNaN(answer2) && answerArr[0]!=0) {
				answer2 = answerArr[1];
			}
			if (isNaN(answer3) && answerArr[0]!=0) {
				answer3 = answerArr[2];
			}

			//var answer ="Num. " + task_num + " / 1. " + answer1 + " / 2. " + answer2 + " / 3. " + answer3;
			var answer = {Num : task_num , answer1 : answer1 , answer2 : answer2 , answer3 : answer3};
			console.log(answer);

			if (!isNaN(answer1) && !isNaN(answer2) && !isNaN(answer3)) {
				//history.pushState(answer, 'task_id: ${task.id}', 'http://urd.nlp.wo.tc:8000/project/check.10/task/${task.id}');
				console.log(answer);
				pybossa.saveTask(task.id, answer).done(function() {
					deferred.resolve();
				});
				$("#loading").fadeIn(500);
				//if ($("#disqus_thread").is(":visible")) {
				//	$('#disqus_thread').toggle();
				//	$('.btn-disqus').toggle();
				//}
			}
			else {
				alert("점수를 매겨주세요!")
			}
		});
		$("#loading").hide();
	}
	else {
		$(".skeleton").hide();
		$("#loading").hide();
		$("#finish").fadeIn(500);
	}
	$('[name="answer1"]').removeAttr('checked');

	//$("#button").hide();
});

pybossa.run('check.10');
</script>
