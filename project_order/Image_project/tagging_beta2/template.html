<style>
span.label {
	color:black;
	font-size:100%;
}
</style>

<div class="row skeleton"> 
    <div class="col-md-12">
        <p class="lead" style="color: black; margin-top:30px;"> 알고계시는 짱구 등장인물을 태깅해주세요! <button id="btn-submit" class="btn btn-large btn-answer pull-right" value='NoTag'><i class="fa fa-repeat"></i> 알고있는 등장인물이 없습니다.</button></p>
    </div>
    <div class="col-md-8 photo">
        <span id="photo-link">
            <img id="photo" src="http://i.imgur.com/GeHxzb7.png" style="max-width=100%">
        </span>
    </div>
</div><!-- End of Skeleton Row -->

<div class="row">
    <!-- Success and Error Messages for the user -->
    <div class="col-md-6 col-md-offset-2" style="height:50px">
        <div id="success" class="alert alert-success" style="display:none;">
            <a class="close">×</a>
            <strong>답변 저장 중...</strong>
        </div>
        <div id="loading" class="alert alert-info" style="display:none;">
            <a class="close">×</a>
            Task 불러오는 중...
        </div>
        <div id="finish" class="alert alert-success" style="display:none;">
            <strong>프로젝트 완료!</strong> 모든 일감을 수행하였습니다.
            <br/>
            <div class="alert-actions">
				<a class="btn small" href="/project/category/featured" style="color:white;">다른 프로젝트 둘러보기</a>
            </div>
        </div>
        <div id="error" class="alert alert-error" style="display:none;">
            <a class="close">×</a>
            <strong>오류 발생!</strong> 문제가 발생하였습니다. 관리자에게 문의 하세요.
        </div>
    </div> <!-- End Success and Error Messages for the user -->
</div> <!-- End of Row -->

<script type="text/javascript" src="/static/js/add-js/anno/annotorious.min.js?ver=6"></script>
<script type="text/javascript" src="/static/vendor/jquery.js"></script>
<script>
      //anno.addPlugin('SemanticTagging', { endpoint_url: 'http://samos.mminf.univie.ac.at:8080/wikipediaminer' });
</script>
<script>
	$(".photo").on('DOMNodeInserted', '.r6o-editor', function(){
		$(".r6o-editable-text").attr('data-placeholder', "이름을 적어주세요.");
		$(".tag").css({display:"none"});
		$(".r6o-editable-text").focus();
	});

$(document).ready(function() {
	$(document).keypress(function (e) {
		if (e.keyCode == 13) {
			$(".r6o-btn").trigger("click");
			e.preventDefault();
		}
	});
});


pybossa.taskLoaded(function(task, deferred) {
    if ( ! $.isEmptyObject(task) ) {
        // load image from flickr
        var img = $('<img />');
        img.load(function() {
            // continue as soon as the image is loaded
            deferred.resolve(task);
        });
        img.attr('src', task.info.url);
        img.attr('id', 'anno_' + task.id);
        img.addClass('img-polaroid');
        img.addClass('annotable');
	img.css({width: "100%"});
        task.info.image = img;
    }
    else {
        deferred.resolve(task);
    }
});

pybossa.presentTask(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        $('#photo-link').html('').append(task.info.image);
        $('#task-id').html(task.id);

        $("#btn-submit").html("<i class='fa fa-repeat'></i> I don't recognize any person, try next one");
        $("#btn-submit").removeClass("btn-success");
        // Load data details
        $("#title").text(task.info.title);
        $("#description").html(task.info.description);
        $("#date_taken").html(task.info.date_taken);
        $("#tags").html(task.info.tags);

		var Tag_arr = ["가족들", "친구들"];

		var anno = Annotorious.init({
			image: document.getElementById('anno_' + task.id),
			tagVocabulary: Tag_arr
		});
		// Attach listeners to handle annotation events
		anno.on('createAnnotation', function(annotation) {
            $("#btn-submit").html("<i class='fa fa-save'></i> Save current annotations");
			$("#btn-submit").addClass("btn-success");
		});

        $('.btn-answer').off('click').on('click', function(evt) {
            var answer = $(evt.target).attr("value");
            if (typeof answer != 'undefined') {
                pybossa.saveTask(task.id, anno.getAnnotations()).done(function() {
                    deferred.resolve();
                });
                $("#loading").fadeIn(500);
                if ($("#disqus_thread").is(":visible")) {
                    $('#disqus_thread').toggle();
                    $('.btn-disqus').toggle();
                }
            }
            else {
                $("#error").show();
            }
        });
        $("#loading").hide();
    }
    else {
        $(".skeleton").hide();
        $("#loading").hide();
        $("#finish").fadeIn(500);
    }
});

pybossa.run('tagging2');
</script>
