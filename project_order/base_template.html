<div class="row">
    <!-- Success and Error Messages for the user -->
    <div class="col-md-12" style="height:50px">
        <!-- Success alert box -->
        <div id="success" class="alert alert-success" style="display:none;">
            <a class="close">×</a><strong>답변 저장 중...</strong>
        </div>
        <!-- Task loading alert box -->
        <div id="loadingTask" class="alert alert-info" style="display:none;">
            <strong>Task 불러오는 중...</strong>
        </div>
        <!-- Task completed alert box -->
        <div id="finish" class="alert alert-success" style="display:none;">
            <strong>프로젝트 완료!</strong> 모든 일감을 수행하였습니다.
            <br/>
            <div class="alert-actions">
<!--                <a class="btn small" href="/" style="color:white">Go back</a>-->
                <a class="btn-small" href="/project/category/featured" style="color:white;">다른 프로젝트 둘러보기</a>
            </div>
        </div>
        <!-- Error alert box -->
        <div id="error" class="alert alert-danger" style="display:none;">
            <a class="close">×</a>
			<strong>오류 발생!</strong> 문제가 발생하였습니다. 관리자에게 문의 하세요.
        </div>
        <!-- Old Browser alert box -->
        <div id="oldBrowser" class="alert alert-info" style="display:none;">
            <a class="close">×</a>
            <p><strong>죄송합니다.</strong> 웹 브라우저가 이 프로젝트를 지원하지 않습니다.<p>
            <div class="alert-actions">
				<a class="btn small" href="/project/category/featured" style="color:white;">다른 프로젝트 둘러보기</a>
			</div>
		</div>
	</div><!-- End of span8 col-md-offset-2-->
</div><!-- End of Row--> <!-- 정답을 눌렀을 때 뜨는 내용들로 딱히 수정하지 않아도 됨 -->

<div class="row skeleton">
	<div class="skeleton col-md-12">
		<u>제목을 입력하시오</u><br/><br/>
		<div id="sentence">문제 <!-- 여기에 만들거나 Jquery를 이용해도 됩니다. --></div>
		<div id="candidate">답변 <!-- 여기에 만들거나 Jquery를 이용해도 됩니다. --></div>

		<!-- 이전 답변 및 답변 수정 기능 method와 name, value, type 변경 금지-->
		<div id="form_div" style="text-align:center; float:right; width:100%;">
			<form action="" method="GET" style="float: right;">
				<button name="data" value="next" type="submit" class="btn btn-primary">다음</button>
			</form>
			<form action="" method="GET" style="float: right;">
				<button name="data" value="delete" type="submit" class="btn btn-warning">답변 삭제</button>
			</form>
			<form action="" method="GET" style="float: right;">
				<button name="data" value="prev" type="submit" class="btn btn-info">이전</button>
			</form>
		</div>
		<br/><br/>

		<!-- 작업 표시줄 기능으로 몇 번째 문제를 하고 있는지, 얼마나 했는지 표시 PYBOSSA의 loadUserProgress() 함수로 자동 추가 가능! -->
		<p>Task: <span id="task-id" class="label label-warning">#</span></p><br/>
		<p>완료한 작업 수: <span id="done" class="label label-info"></span> / 총 작업 수:
		<span id="total" class="label label-inverse" style="background-color: #3498DB;"></span></p>
		<div class="progress progress-striped">
			<div id="progress" rel="tooltip" title="#" class="progress-bar" style="width: 0%;"  role="progressbar"></div>
		</div> 
		<!-- /작업 표시줄 -->
	</div>
</div>

<!-- PyBossa interface -->
<script>
function loadUserProgress() { // 작업 표시줄 함수
	pybossa.userProgress(' 프로젝트 short_name을 입력해 주세요!').done(function(data){
		var pct = Math.round((data.done*100)/data.total);
		console.log(pct);
		$("#progress").css("width", pct.toString() +"%");
		$("#progress").attr("title", pct.toString() + "% completed!");
		$("#progress").tooltip({'placement': 'left'}); 
		$("#total").text(data.total);
		$("#done").text(data.done);
	});
}

pybossa.taskLoaded(function(task, deferred){ // task를 불러오는 함수
    if ( !$.isEmptyObject(task) ) {
        $("#loadingTask").hide();
        deferred.resolve(task);
        } // End if task empty
    else {
        deferred.resolve(task);
        }
});

pybossa.presentTask(function(task, deferred){ // task를 뿌리는 함수 (결과 저장도 여기서 일어납니다.)
	$("#loadingTask").show();
    if ( !$.isEmptyObject(task) ) {

       if(task.info.sentence == 'Done') {
			pybossa.saveTask( task.id, -1, {}).done( function(data) { deferred.resolve(); });
			delete task;
		} else {
				loadUserProgress();
				$("#loadingTask").hide();
		}
        $(".btn-submit").off('click').on('click', function(evt){
			var answer = (this).value; // 답변 저장으로 원하는 form을 제작할 수 있습니다.
            console.log(answer);

		    // db에 현재 결과 저장
            pybossa.saveTask( task.id, answer).done( function(data) {
                // Show the feedback div
                $("#success").fadeIn();
                // Fade out the pop-up after a 2000 miliseconds
                setTimeout(function() { $("#success").fadeOut() }, 2000);
                deferred.resolve();
            });
        });
    }
    else {
        $(".skeleton").hide();
        $("#loadingTask").hide();
        $("#finish").fadeIn();	
    }
});

pybossa.run(' 프로젝트 short_name을 입력해 주세요!');
</script>
